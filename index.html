<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oven X - Multan Autonomous System</title>
    <style>
        :root {
            --ue-red: #5e0000;
            --ue-glow: #ff4d00;
            --ue-dark: #0a0a0a;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background: radial-gradient(circle at center, #1a1a1a 0%, #050505 100%);
            color: #e0e0e0;
            margin: 0;
            padding-bottom: 100px;
        }

        header {
            background: linear-gradient(180deg, #222 0%, #000 100%);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid var(--ue-glow);
            box-shadow: 0 5px 30px rgba(255, 77, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo { font-size: 28px; font-weight: 900; letter-spacing: 3px; text-transform: uppercase; color: white; margin: 0; }
        .logo span { color: var(--ue-glow); }

        .container { max-width: 550px; margin: auto; padding: 20px; }
        .section-title { font-weight: 800; color: var(--ue-glow); margin: 30px 0 10px; text-transform: uppercase; font-size: 13px; letter-spacing: 2px; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .btn {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            padding: 18px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn:hover { border-color: var(--ue-glow); background: rgba(255, 255, 255, 0.07); }
        .price-tag { color: var(--ue-glow); font-weight: bold; margin-top: 5px; font-size: 14px; }

        /* Cart Bar */
        #cart-bar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; background: rgba(0,0,0,0.85);
            backdrop-filter: blur(15px); border: 1px solid var(--ue-glow);
            padding: 15px 25px; border-radius: 50px; display: flex;
            justify-content: space-between; align-items: center; z-index: 5000;
        }
        .checkout-btn { background: var(--ue-glow); color: white; padding: 10px 20px; border-radius: 20px; font-weight: 900; cursor: pointer; text-transform: uppercase; }

        /* Modal & Overlays */
        #overlay-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; display: none; padding: 25px; box-sizing: border-box; overflow-y: auto; }
        .chat-bubble { background: #111; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #222; font-size: 15px; line-height: 1.6; }
        
        /* THE CALCULATION CARD (Matches your screenshot) */
        .calc-card {
            background: white; color: black; border-radius: 20px; padding: 30px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin: 20px 0;
        }
        .calc-card h2 { color: #8b0000; font-size: 18px; margin: 0; }
        .calc-card .amount { font-size: 48px; font-weight: 900; color: #1a1a1a; margin: 10px 0; }
        .calc-card .label { text-transform: uppercase; font-size: 10px; letter-spacing: 1px; color: #888; }

        .next-btn { background: var(--ue-red); color: white; width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; font-size: 16px; cursor: pointer; }
        .confirm-btn { background: #25D366; color: white; width: 100%; padding: 20px; border-radius: 12px; text-align: center; text-decoration: none; display: block; font-weight: 900; font-size: 18px; margin-top: 20px; }
    </style>
</head>
<body>

<header>
    <p class="logo">OVEN <span>X</span></p>
    <p id="table-indicator" style="font-size:10px; opacity:0.5; letter-spacing:2px; margin-top:5px;"></p>
</header>

<div class="container" id="menu-container"></div>

<div id="cart-bar">
    <div style="display:flex; flex-direction:column;">
        <span id="cart-count" style="font-size:10px; color:#888;">0 ITEMS</span>
        <span id="cart-total" style="font-size:18px;">RS 0</span>
    </div>
    <div class="checkout-btn" onclick="startCheckout()">Checkout</div>
</div>

<!-- Quantity Modal -->
<div id="modal-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:10001; display:none; justify-content:center; align-items:center;">
    <div style="background:#111; border:1px solid var(--ue-glow); padding:30px; border-radius:20px; width:85%; max-width:350px; text-align:center;">
        <h3 id="modal-item-name" style="color:var(--ue-glow); margin-top:0;"></h3>
        <input type="number" id="qty-input" value="1" min="1" style="width:60px; padding:10px; background:#000; color:white; border:1px solid #333; text-align:center; font-size:18px;">
        <textarea id="special-note" placeholder="Instructions..." style="width:100%; background:#000; color:white; border:1px solid #333; padding:10px; margin-top:15px;"></textarea>
        <button onclick="addToCartFinal()" style="width:100%; background:var(--ue-glow); color:white; border:none; padding:15px; margin-top:15px; border-radius:10px; font-weight:bold;">ADD TO CART</button>
    </div>
</div>

<div id="overlay-screen"><div id="checkout-content"></div></div>

<script>
    // MULTAN GULGASHT COORDINATES
    const STORE_LAT = 30.2215; 
    const STORE_LON = 71.4912;

    const menuData = {
        "Starter": [{name: "Plain Fries", price: 230}, {name: "Loaded Fries", price: 599}, {name: "Pizza Fries", price: 720}, {name: "Oven Baked Wings", price: 399}],
        "Burgers": [{name: "Zinger Burger", price: 420}, {name: "Mighty Burger", price: 699}, {name: "Smokey Grilled", price: 550}],
        "Pizza": [{name: "Chicken Tikka", price: {S:499, M:999, L:1549}}, {name: "Chicken Fajita", price: {S:499, M:999, L:1549}}],
        "Bar Menu": [{name: "Next Cola Buddy", price: 130}, {name: "Coke 1.5L", price: 230}]
    };

    let cart = [], selectedItem = null, orderType = "", tableNum = "", userAddress = "", deliveryCharge = 0;

    const urlParams = new URLSearchParams(window.location.search);
    if(urlParams.has('table')) {
        tableNum = urlParams.get('table');
        document.getElementById('table-indicator').innerText = "DINE-IN SECTOR " + tableNum;
    } else { document.getElementById('table-indicator').innerText = "MULTAN CENTRAL BRANCH"; }

    const container = document.getElementById('menu-container');
    for (let cat in menuData) {
        let title = document.createElement('div'); title.className = 'section-title'; title.innerText = cat; container.appendChild(title);
        let grid = document.createElement('div'); grid.className = 'grid';
        menuData[cat].forEach(item => {
            let btn = document.createElement('div'); btn.className = 'btn';
            btn.innerHTML = <div>${item.name}</div><div class="price-tag">${typeof item.price === 'object' ? 'Select Size' : 'Rs '+item.price}</div>;
            btn.onclick = () => { selectedItem = item; openOrderFlow(); }; grid.appendChild(btn);
        });
        container.appendChild(grid);
    }

    function openOrderFlow() {
        if(typeof selectedItem.price === 'object') {
            let size = prompt("Select Size: S, M, or L").toUpperCase();
            if(selectedItem.price[size]) {
                selectedItem = { name: selectedItem.name + " (" + size + ")", price: selectedItem.price[size] };
            } else { alert("Invalid Size"); return; }
        }
        document.getElementById('modal-item-name').innerText = selectedItem.name;
        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }
    function addToCartFinal() {
        cart.push({ ...selectedItem, qty: parseInt(document.getElementById('qty-input').value), note: document.getElementById('special-note').value });
        updateCartBar(); closeModal();
    }
    function updateCartBar() {
        document.getElementById('cart-count').innerText = cart.reduce((s, i) => s + i.qty, 0) + " ITEMS";
        document.getElementById('cart-total').innerText = "RS " + cart.reduce((s, i) => s + (i.price * i.qty), 0);
    }

    function startCheckout() {
        document.getElementById('overlay-screen').style.display = 'block';
        renderServiceStep();
    }

    function renderServiceStep() {
        document.getElementById('checkout-content').innerHTML = `
            <div class="chat-bubble">Select Service:</div>
            <button class="next-btn" style="background:#007bff; margin-bottom:10px" onclick="orderType='Dine-In'; renderFinalSummary()">Dine-In (+7% SC)</button>
            <button class="next-btn" style="background:#444; margin-bottom:10px" onclick="orderType='Takeaway'; renderFinalSummary()">Takeaway</button>
            <button class="next-btn" onclick="orderType='Delivery'; renderAddressStep()">Delivery</button>
        `;
    }

    function renderAddressStep() {
        document.getElementById('checkout-content').innerHTML = `
            <div class="chat-bubble">Input Destination Address:</div>
            <input type="text" id="uAddr" placeholder="House/Street/Colony..." style="width:100%; padding:15px; border-radius:10px; border:1px solid #333; background:#111; color:white; box-sizing:border-box;">
            <button class="next-btn" style="margin-top:15px" onclick="userAddress=document.getElementById('uAddr').value; calculateDelivery()">Calculate Charges</button>
        `;
    }

    function calculateDelivery() {
        document.getElementById('checkout-content').innerHTML = <div class="chat-bubble">ðŸ“¡ Locating your distance from Gulgasht...</div>;
        navigator.geolocation.getCurrentPosition(pos => {
            const lat = pos.coords.latitude, lon = pos.coords.longitude;
            const R = 6371;
            const dLat = (lat - STORE_LAT) * Math.PI / 180, dLon = (lon - STORE_LON) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(STORE_LAT * Math.PI / 180) * Math.cos(lat * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
            const dist = R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
            
            // Formula: 1km x 12 Round Trip
            deliveryCharge = Math.ceil((dist * 2) * 12);
            showCalcResult();
        }, () => { alert("GPS Denied"); renderServiceStep(); });
    }

    function showCalcResult() {
        document.getElementById('checkout-content').innerHTML = `
            <div class="calc-card">
                <img src="https://oven-x-deliverer--ovenxoperations.replit.app/logo.png" style="width:80px; margin-bottom:10px;">
                <h2>Thank You!</h2>
                <p style="font-size:12px; color:#666;">Estimate for your location</p>
                <div class="label" style="margin-top:15px;">Delivery Charges</div>
                <div class="amount">Rs ${deliveryCharge}</div>
                <p style="font-size:11px; color:#999;">Address: ${userAddress}</p>
            </div>
            <button class="next-btn" style="background:#25D366" onclick="renderFinalSummary()">Generate Final Bill</button>
        `;
    }

    function renderFinalSummary() {
        const foodTotal = cart.reduce((s, i) => s + (i.price * i.qty), 0);
        let sc = (orderType === "Dine-In") ? foodTotal * 0.07 : 0;
        const grandTotal = foodTotal + deliveryCharge + sc;

        const waMsg = encodeURIComponent(*OVEN X ORDER*\nType: ${orderType}\n${tableNum ? 'Table: '+tableNum : ''}\n\n${cart.map(i=> i.qty + "x " + i.name).join("\n")}\n\nFood: Rs ${foodTotal}${sc > 0 ? '\nService Charge: Rs ' + sc.toFixed(0) : ''}${deliveryCharge > 0 ? '\nDelivery: Rs ' + deliveryCharge : ''}\n*TOTAL: Rs ${grandTotal.toFixed(0)}*\nAddress: ${userAddress});

        document.getElementById('checkout-content').innerHTML = `
            <div class="chat-bubble">
                <b style="color:var(--ue-glow)">ORDER SUMMARY</b><br><br>
                ${cart.map(i => ${i.qty}x ${i.name}).join('<br>')}
                <br><hr style="border:0; border-top:1px solid #333; margin:10px 0;">
                Subtotal: Rs ${foodTotal}
                ${sc > 0 ? '<br>Service Charge (7%): Rs ' + sc.toFixed(0) : ''}
                ${deliveryCharge > 0 ? '<br>Delivery Charges: Rs ' + deliveryCharge : ''}
                <br><span style="font-size:20px; color:var(--ue-glow)">TOTAL: RS ${grandTotal.toFixed(0)}</span>
            </div>
            <a href="https://wa.me/923001450301?text=${waMsg}" class="confirm-btn">CONFIRM ON WHATSAPP</a>
        `;
    }
</script>
</body>
</html>
