<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oven X Multan - Official Order Bot</title>
    <style>
        :root { --primary-red: #8b0000; --accent-orange: #f37021; --light-gray: #f8f9fa; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f0f0; margin: 0; display: flex; justify-content: center; height: 100vh; align-items: center; }
        #chat-container { width: 100%; max-width: 450px; height: 95vh; background: white; border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2); border: 1px solid #ddd; }
        #header { background: var(--primary-red); color: white; padding: 15px; text-align: center; border-bottom: 4px solid var(--accent-orange); }
        #chat-window { flex: 1; padding: 15px; overflow-y: auto; background: var(--light-gray); display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 14px; border-radius: 15px; max-width: 85%; font-size: 14px; line-height: 1.4; }
        .bot { background: white; color: #333; align-self: flex-start; border-bottom-left-radius: 2px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .user { background: var(--primary-red); color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        #input-area { padding: 12px; background: white; border-top: 1px solid #eee; display: flex; gap: 8px; }
        input { flex: 1; padding: 10px 15px; border: 1px solid #ddd; border-radius: 25px; outline: none; }
        button { background: var(--accent-orange); color: white; border: none; padding: 8px 18px; border-radius: 25px; cursor: pointer; font-weight: bold; }
        .wa-btn { background: #25D366; color: white; text-decoration: none; padding: 12px; border-radius: 8px; text-align: center; display: block; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div id="chat-container">
    <div id="header">
        <h2 style="margin:0; font-size:1.2em;">Oven X Multan</h2>
        <p style="margin:0; font-size:0.7em;">34-A Gulgasht Colony</p>
    </div>
    <div id="chat-window" id="chatWindow">
        <div class="msg bot">Welcome to Oven X! ðŸ‘‹<br><br>Please select a <b>Category Number</b> to see the items:</div>
    </div>
    <div id="input-area">
        <input type="text" id="userInput" placeholder="Type here..." autofocus>
        <button onclick="handleSend()">Send</button>
    </div>
</div>

<script>
    const WHATSAPP_NUMBER = "923001450301"; 

    const menu = {
        "Starters": [
            {id: 1, name: "Plain Fries", price: 230},
            {id: 2, name: "Loaded Fries", price: 599},
            {id: 3, name: "Pizza Fries", price: 720},
            {id: 4, name: "Hot Wings", price: 399}
        ],
        "Fried Burgers": [
            {id: 10, name: "Zinger Burger", price: 420},
            {id: 11, name: "Mighty Burger", price: 699},
            {id: 12, name: "Crispy Jalapeno", price: 550}
        ],
        "Grilled Burgers": [
            {id: 20, name: "CM Grilled", price: 499},
            {id: 21, name: "Smokey Grilled", price: 550},
            {id: 22, name: "Jalapeno Blaze", price: 749}
        ],
        "Pan Pizza": [
            {id: 30, name: "Chicken Tikka", price: {S:499, M:999, L:1549}},
            {id: 31, name: "Chicken Fajita", price: {S:499, M:999, L:1549}},
            {id: 32, name: "Chicken Supreme", price: {S:499, M:999, L:1549}}
        ],
        "Deep Dish Pizza": [
            {id: 40, name: "Mild Butter", price: {M:1749, L:2449}},
            {id: 41, name: "OvenX Special Deep Dish", price: {M:1749, L:2449}}
        ],
        "Extreme Pizza": [
            {id: 50, name: "Extreme Peri-Peri", price: {M:1499, L:2049}},
            {id: 51, name: "Extreme Flaming Kabab", price: {M:1499, L:2049}}
        ],
        "Steaks": [
            {id: 60, name: "Mexican Steak", price: 1549},
            {id: 61, name: "Mushroom Steak", price: 1549},
            {id: 62, name: "Peper Steak", price: 1499}
        ],
        "Bar Menu (Beverages)": [
            {id: 70, name: "Next Cola Buddy", price: 130},
            {id: 71, name: "Coke 1.5L", price: 190},
            {id: 72, name: "Next Cola 1.5L", price: 190},
            {id: 73, name: "Coke Tin", price: 210},
            {id: 74, name: "Mineral Water (S)", price: 99}
        ]
    };

    let step = "CATEGORY_SELECT";
    let cart = [];
    let currentCategory = "";
    let tempItem = null;
    let tempOrder = {};

    function addMessage(text, sender, isHTML = false) {
        const div = document.createElement('div');
        div.className = `msg ${sender}`;
        if(isHTML) div.innerHTML = text; else div.innerText = text;
        document.getElementById('chat-window').appendChild(div);
        document.getElementById('chat-window').scrollTop = document.getElementById('chat-window').scrollHeight;
    }

    function showCategories() {
        let m = "<b>Menu Categories:</b><br>";
        Object.keys(menu).forEach((cat, index) => {
            m += `${index + 1}. ${cat}<br>`;
        });
        m += "<br>Type the <b>Number</b> of the category.";
        addMessage(m, "bot", true);
        step = "CATEGORY_SELECT";
    }

    showCategories();

    function handleSend() {
        const val = document.getElementById('userInput').value.trim();
        if (!val) return;
        addMessage(val, 'user');
        document.getElementById('userInput').value = "";
        const clean = val.toLowerCase();

        if (clean === "menu" || clean === "back") {
            return showCategories();
        }

        if (clean === "checkout") {
            if(cart.length === 0) return addMessage("Cart is empty!", "bot");
            addMessage("Please enter your <b>Delivery Address</b>:", "bot", true);
            step = "ADDRESS";
            return;
        }

        if (step === "CATEGORY_SELECT") {
            const index = parseInt(val) - 1;
            const keys = Object.keys(menu);
            if (keys[index]) {
                currentCategory = keys[index];
                let m = `<b>${currentCategory}:</b><br>`;
                menu[currentCategory].forEach(item => {
                    m += `${item.id}. ${item.name} - Rs ${typeof item.price === 'object' ? 'Select Size' : item.price}<br>`;
                });
                m += "<br>Type the <b>Item Number</b> to add.";
                addMessage(m, "bot", true);
                step = "ITEM_SELECT";
            } else {
                addMessage("Invalid selection. Please type a number from the list.", "bot");
            }
        }

        else if (step === "ITEM_SELECT") {
            const item = menu[currentCategory].find(i => i.id == val);
            if (item) {
                tempItem = item;
                if (typeof item.price === 'object') {
                    let sizes = Object.keys(item.price).join(", ");
                    addMessage(`Select Size (${sizes}):`, "bot");
                    step = "SIZE_SELECT";
                } else {
                    tempOrder.price = item.price;
                    addMessage(`How many ${item.name}?`, "bot");
                    step = "QUANTITY_SELECT";
                }
            } else {
                addMessage("Invalid item number.", "bot");
            }
        }

        else if (step === "SIZE_SELECT") {
            const size = val.toUpperCase();
            if (tempItem.price[size]) {
                tempOrder.nameSuffix = ` (${size})`;
                tempOrder.price = tempItem.price[size];
                addMessage(`How many ${tempItem.name}${tempOrder.nameSuffix}?`, "bot");
                step = "QUANTITY_SELECT";
            } else {
                addMessage("Please select a valid size (S, M, or L).", "bot");
            }
        }

        else if (step === "QUANTITY_SELECT") {
            const qty = parseInt(val);
            if (qty > 0) {
                tempOrder.qty = qty;
                addMessage("Any special instructions? (e.g. No Spicy) or type 'None':", "bot");
                step = "NOTE_SELECT";
            } else {
                addMessage("Please enter a number.", "bot");
            }
        }

        else if (step === "NOTE_SELECT") {
            const note = (clean === "none") ? "" : val;
            cart.push({
                name: tempItem.name + (tempOrder.nameSuffix || ""),
                price: tempOrder.price,
                qty: tempOrder.qty,
                note: note
            });
            tempOrder = {};
            addMessage("Added! Type <b>'Menu'</b> to add more or <b>'Checkout'</b>.", "bot", true);
            step = "IDLE";
        }

        else if (step === "ADDRESS") {
            tempOrder.address = val;
            addMessage("Distance from Gulgasht Branch in KM?", "bot");
            step = "DISTANCE";
        }

        else if (step === "DISTANCE") {
            const dist = parseFloat(val);
            if (isNaN(dist)) return addMessage("Enter distance in numbers.", "bot");
            
            const delivery = (dist * 2) * 12;
            const foodTotal = cart.reduce((s, i) => s + (i.price * i.qty), 0);
            
            let summary = `<b>Receipt:</b><br>`;
            cart.forEach(i => summary += `â€¢ ${i.qty}x ${i.name} ${i.note ? '['+i.note+']' : ''} = ${i.price * i.qty}<br>`);
            summary += `<br>Food: Rs ${foodTotal}<br>Delivery (Round Trip): Rs ${delivery.toFixed(0)}<br><b>Total: Rs ${(foodTotal+delivery).toFixed(0)}</b>`;
            addMessage(summary, "bot", true);

            const waMsg = encodeURIComponent(`*New Order - OvenX Multan*\n\n${cart.map(i=> i.qty + "x " + i.name + (i.note ? " ("+i.note+")" : "")).join("\n")}\n\n*Address:* ${tempOrder.address}\n*Delivery Fee:* Rs ${delivery.toFixed(0)}\n*Grand Total:* Rs ${(foodTotal+delivery).toFixed(0)}`);
            addMessage(`<a href="https://wa.me/${WHATSAPP_NUMBER}?text=${waMsg}" class="wa-btn" target="_blank">Confirm on WhatsApp</a>`, "bot", true);
        }
    }
</script>
</body>
</html>
